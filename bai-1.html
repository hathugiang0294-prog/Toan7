<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>B√†i 1: T·∫≠p h·ª£p c√°c s·ªë h·ªØu t·ªâ - K·∫øt n·ªëi tri th·ª©c</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
    <script>
        window.MathJax = {
            tex: { 
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script" async></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        body { font-family: 'Comfortaa', cursive; scroll-behavior: smooth; }
        .mjx-container { max-width: 100% !important; overflow-x: auto !important; }
        
        .section-dashed {
            border: 3px dashed #cbd5e1;
            border-radius: 24px;
            transition: border-color 0.3s;
        }
        .section-dashed:hover { border-color: #3b82f6; }

        .check-btn { transition: all 0.2s; cursor: pointer; -webkit-tap-highlight-color: transparent; border: 2px solid #e2e8f0; }
        .selected-true { background-color: #22c55e !important; color: white !important; border-color: #16a34a !important; }
        .selected-false { background-color: #ef4444 !important; color: white !important; border-color: #dc2626 !important; }
        .correct-highlight { border: 3px solid #22c55e !important; box-shadow: 0 0 8px rgba(34, 197, 94, 0.4); }
        
        .mcq-option { border: 2px solid #e2e8f0; cursor: pointer; transition: all 0.2s; border-radius: 16px; }
        .mcq-option.selected { border-color: #3b82f6; background-color: #eff6ff; }
        .mcq-option.correct { border-color: #22c55e; background-color: #dcfce7; color: #166534; }
        .mcq-option.wrong { border-color: #ef4444; background-color: #fee2e2; color: #991b1b; }
        
        .fill-input { border-bottom: 2px dashed #3b82f6; outline: none; text-align: center; width: 120px; font-weight: bold; color: #2563eb; background: transparent; }
        .fill-correct { background-color: #dcfce7; border-color: #22c55e; border-style: solid; }
        .fill-wrong { background-color: #fee2e2; border-color: #ef4444; border-style: solid; }
        
        .feedback-box { display: none; margin-top: 0.5rem; padding: 0.75rem; border-radius: 0.75rem; border-left: 4px solid #ef4444; background-color: #fffafb; font-size: 0.85rem; line-height: 1.4; }
        .is-submitted .feedback-box { display: block; }

        .btn-download { background-color: #4f46e5; color: white; padding: 6px 12px; border-radius: 99px; font-size: 0.75rem; font-weight: bold; display: flex; items-center gap: 1; transition: opacity 0.2s; }
        .btn-download:hover { opacity: 0.9; }

        #loading-overlay { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 100; flex-direction: column; align-items: center; justify-content: center; }
        .loader { border: 6px solid #f3f3f3; border-top: 6px solid #3b82f6; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Animation cho kh·ªüi ƒë·ªông */
        .warmup-container { transition: all 0.5s ease; }
        .warmup-hidden { opacity: 0.3; pointer-events: none; filter: blur(2px); }
        .gift-box { cursor: pointer; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-3 md:p-6 pb-24 text-slate-800">

    <div id="loading-overlay">
        <div class="loader mb-4"></div>
        <p class="font-bold text-blue-600 animate-pulse">AI ƒêang so·∫°n b·ªô ƒë·ªÅ m·ªõi cho b·∫°n...</p>
    </div>

    <div class="max-w-4xl mx-auto space-y-12">
        
        <!-- TI√äU ƒê·ªÄ CH√çNH -->
        <div class="text-center py-6">
            <h1 class="text-3xl md:text-4xl font-black text-blue-600 uppercase tracking-tighter flex items-center justify-center gap-3">
                <span class="edu-icon">üìê</span> B√†i 1: T·∫≠p h·ª£p c√°c s·ªë h·ªØu t·ªâ <span class="edu-icon">‚úèÔ∏è</span>
            </h1>
            <p class="text-slate-500 font-bold mt-2">S√°ch K·∫øt n·ªëi tri th·ª©c v·ªõi cu·ªôc s·ªëng - To√°n 7</p>
        </div>

        <!-- H·ªòP KI·∫æN TH·ª®C -->
        <div id="capture-knowledge" class="bg-white p-6 section-dashed shadow-sm relative">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <h2 class="text-xl font-bold text-blue-800 flex items-center gap-2">
                    <span class="p-2 bg-blue-100 rounded-lg text-blue-600">üìñ</span>
                    Ki·∫øn Th·ª©c Tr·ªçng T√¢m (B√†i 1)
                </h2>
                <button onclick="downloadAsImage('capture-knowledge', 'Kien_Thuc_Bai_1')" class="btn-download">
                    <span>üñºÔ∏è</span> T·∫£i ·∫¢nh Ki·∫øn Th·ª©c
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div class="bg-blue-50/50 p-5 rounded-2xl border border-blue-100 space-y-3 shadow-inner">
                    <h3 class="font-bold text-blue-700">1. Kh√°i ni·ªám s·ªë h·ªØu t·ªâ</h3>
                    <ul class="space-y-2 text-slate-600">
                        <li>‚Ä¢ S·ªë vi·∫øt ƒë∆∞·ª£c d∆∞·ªõi d·∫°ng $\frac{a}{b}$ ($a, b \in \mathbb{Z}, b \neq 0$).</li>
                        <li>‚Ä¢ T·∫≠p h·ª£p k√Ω hi·ªáu l√† $\mathbb{Q}$.</li>
                    </ul>
                </div>
                <div class="bg-green-50/50 p-5 rounded-2xl border border-green-100 space-y-3 shadow-inner">
                    <h3 class="font-bold text-green-700">2. Th·ª© t·ª± v√† Tr·ª•c s·ªë</h3>
                    <ul class="space-y-2 text-slate-600">
                        <li>‚Ä¢ M·ªçi s·ªë h·ªØu t·ªâ ƒë·ªÅu c√≥ ƒëi·ªÉm bi·ªÉu di·ªÖn tr√™n tr·ª•c s·ªë.</li>
                        <li>‚Ä¢ S·ªë ƒë·ªëi c·ªßa $a$ l√† $-a$. T·ªïng hai s·ªë ƒë·ªëi b·∫±ng 0.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- PH·∫¶N KH·ªûI ƒê·ªòNG M·ªöI: NHI·ªÜM V·ª§ PH√Å BƒÇNG -->
        <div id="warmup-section" class="bg-white p-8 section-dashed border-blue-200 shadow-md relative overflow-hidden">
            <div id="warmup-task">
                <h2 class="text-2xl font-black text-blue-600 flex items-center gap-3 mb-4">
                    <span class="text-3xl">üßä</span> NHI·ªÜM V·ª§ PH√Å BƒÇNG
                </h2>
                <p class="text-slate-600 mb-6 font-medium">Gi·∫£i m√£ c√¢u ƒë·ªë sau ƒë·ªÉ m·ªü kh√≥a <strong>H·ªôp Qu√† May M·∫Øn</strong> tr∆∞·ªõc khi v√†o b√†i h·ªçc:</p>
                
                <div class="bg-blue-50 p-6 rounded-3xl border-2 border-blue-100 mb-6">
                    <p class="text-lg font-bold text-blue-800 text-center">
                        "T√¥i l√† m·ªôt s·ªë h·ªØu t·ªâ. T√¥i kh√¥ng d∆∞∆°ng, c≈©ng kh√¥ng √¢m. <br>ƒê·ªë b·∫°n t√¥i l√† s·ªë m·∫•y?"
                    </p>
                    <div class="mt-6 flex flex-col items-center gap-4">
                        <input type="text" id="warmup-input" placeholder="Nh·∫≠p s·ªë..." class="w-32 p-3 text-center text-2xl font-bold rounded-2xl border-2 border-blue-300 focus:border-blue-500 outline-none transition-all">
                        <button onclick="unlockGift()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-2xl transition-all shadow-lg active:scale-95">
                            GI·∫¢I M√É üöÄ
                        </button>
                    </div>
                </div>
            </div>

            <!-- H·ªôp qu√† ·∫©n -->
            <div id="gift-section" class="hidden flex flex-col items-center text-center animate-bounce-in">
                <div class="text-7xl mb-4 gift-box" onclick="openGift()">üéÅ</div>
                <h3 class="text-xl font-bold text-orange-600">B·∫†N ƒê√É M·ªû KH√ìA TH√ÄNH C√îNG!</h3>
                <p class="text-slate-500 text-sm">Nh·∫•n v√†o h·ªôp qu√† ƒë·ªÉ nh·∫≠n ph·∫ßn th∆∞·ªüng...</p>
            </div>

            <!-- N·ªôi dung qu√† t·∫∑ng -->
            <div id="reward-content" class="hidden text-center space-y-4 py-4">
                <div class="text-5xl">‚ú®‚≠êüçÄ</div>
                <h3 class="text-2xl font-black text-green-600 uppercase">Ch√∫c m·ª´ng S·ª© Gi·∫£ To√°n H·ªçc!</h3>
                <p class="text-slate-700 italic">"Ki·∫øn th·ª©c l√† kho b√°u, nh∆∞ng th·ª±c h√†nh ch√≠nh l√† ch√¨a kh√≥a ƒë·ªÉ m·ªü kho b√°u ƒë√≥."</p>
                <div class="flex justify-center gap-2">
                    <span class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-bold border border-yellow-200">Huy hi·ªáu Tinh Anh üèÖ</span>
                    <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold border border-green-200">+100 NƒÉng l∆∞·ª£ng ‚ö°</span>
                </div>
                <p class="text-blue-600 font-bold animate-pulse mt-4">S·∫µn s√†ng chinh ph·ª•c c√°c th·ª≠ th√°ch b√™n d∆∞·ªõi nh√©! üëá</p>
            </div>
        </div>

        <!-- PH·∫¶N 1: MCQ -->
        <div id="capture-mcq" class="bg-white p-6 section-dashed shadow-sm">
            <div class="flex justify-between items-center mb-8 border-l-4 border-blue-600 pl-3">
                <h2 class="text-xl font-bold text-blue-800 uppercase">üìù PH·∫¶N 1: Tr·∫Øc nghi·ªám (15 c√¢u)</h2>
                <button onclick="downloadAsImage('capture-mcq', 'De_Trac_Nghiem_Bai_1')" class="btn-download">
                    <span>üñºÔ∏è</span> T·∫£i ·∫¢nh ƒê·ªÅ
                </button>
            </div>
            <div id="mcq-container" class="space-y-8"></div>
        </div>

        <!-- PH·∫¶N 2: T/F -->
        <div id="capture-tf" class="bg-white p-6 section-dashed shadow-sm">
            <div class="flex justify-between items-center mb-8 border-l-4 border-blue-600 pl-3">
                <h2 class="text-xl font-bold text-blue-800 uppercase">‚úîÔ∏è PH·∫¶N 2: ƒê√∫ng/Sai (5 c√¢u)</h2>
                <button onclick="downloadAsImage('capture-tf', 'De_Dung_Sai_Bai_1')" class="btn-download">
                    <span>üñºÔ∏è</span> T·∫£i ·∫¢nh ƒê·ªÅ
                </button>
            </div>
            <div id="tf-container" class="space-y-10"></div>
        </div>

        <!-- PH·∫¶N 3: FILL -->
        <div id="capture-fill" class="bg-white p-6 section-dashed shadow-sm">
            <div class="flex justify-between items-center mb-8 border-l-4 border-blue-600 pl-3">
                <h2 class="text-xl font-bold text-blue-800 uppercase">üñãÔ∏è PH·∫¶N 3: Tr·∫£ l·ªùi ng·∫Øn (5 c√¢u)</h2>
                <button onclick="downloadAsImage('capture-fill', 'De_Tra_Loi_Ngan_Bai_1')" class="btn-download">
                    <span>üñºÔ∏è</span> T·∫£i ·∫¢nh ƒê·ªÅ
                </button>
            </div>
            <div id="fill-container" class="space-y-6"></div>
        </div>

        <!-- N·ªòP B√ÄI -->
        <div class="text-center py-12">
            <button id="submit-btn" onclick="checkResults()" class="bg-blue-600 hover:bg-blue-700 text-white font-black py-5 px-16 rounded-full shadow-2xl transition-all active:scale-95 text-xl tracking-widest flex items-center gap-4 mx-auto">
                <span>üì§</span> N·ªòP B√ÄI KI·ªÇM TRA
            </button>
            
            <div id="result-board" class="mt-8 hidden">
                <div class="bg-white section-dashed p-8 inline-block shadow-xl w-full max-w-2xl">
                    <div id="score-text" class="text-4xl font-black text-blue-700 mb-2"></div>
                    
                    <div class="mt-8 pt-6 border-t border-slate-100">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center justify-center gap-2">
                            üöÄ TI·ªÜN √çCH N√ÇNG CAO CHO B·∫†N
                        </h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button onclick="location.reload()" class="flex flex-col items-center justify-center p-4 bg-slate-50 hover:bg-slate-100 border-2 border-slate-200 rounded-2xl transition-all group">
                                <span class="text-2xl mb-1 group-hover:rotate-12 transition-transform">üîÑ</span>
                                <span class="font-bold text-slate-700">L√†m l·∫°i ƒë·ªÅ n√†y</span>
                                <span class="text-xs text-slate-500">X√≥a k·∫øt qu·∫£ v√† l√†m l·∫°i t·ª´ ƒë·∫ßu</span>
                            </button>
                            <button onclick="generateNewLevel('similar')" class="flex flex-col items-center justify-center p-4 bg-blue-50 hover:bg-blue-100 border-2 border-blue-200 rounded-2xl transition-all group">
                                <span class="text-2xl mb-1 group-hover:scale-110 transition-transform">üé≠</span>
                                <span class="font-bold text-blue-700">ƒê·ªÅ t∆∞∆°ng t·ª±</span>
                                <span class="text-xs text-blue-500">C√¢u h·ªèi m·ªõi, ƒë·ªô kh√≥ gi·ªØ nguy√™n</span>
                            </button>
                            <button onclick="generateNewLevel('advanced')" class="flex flex-col items-center justify-center p-4 bg-purple-50 hover:bg-purple-100 border-2 border-purple-200 rounded-2xl transition-all group">
                                <span class="text-2xl mb-1 group-hover:-translate-y-1 transition-transform">üî•</span>
                                <span class="font-bold text-purple-700">Th·ª≠ th√°ch N√¢ng cao</span>
                                <span class="text-xs text-purple-500">C√¢u h·ªèi kh√≥ h∆°n, t∆∞ duy s√¢u h∆°n</span>
                            </button>
                            <button onclick="downloadTextOffline()" class="flex flex-col items-center justify-center p-4 bg-indigo-50 hover:bg-indigo-100 border-2 border-indigo-200 rounded-2xl transition-all group">
                                <span class="text-2xl mb-1 group-hover:bounce transition-transform">üíæ</span>
                                <span class="font-bold text-indigo-700">L∆∞u ƒë√°p √°n</span>
                                <span class="text-xs text-indigo-500">T·∫£i file txt xem offline</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; 

        const ORIGINAL_MCQ = [
            { l: "nb", q: "T·∫≠p h·ª£p c√°c s·ªë h·ªØu t·ªâ ƒë∆∞·ª£c k√Ω hi·ªáu l√†:", options: ["$\\mathbb{N}$", "$\\mathbb{Z}$", "$\\mathbb{Q}$", "$\\mathbb{R}$"], correct: 2, exp: "S·ªë h·ªØu t·ªâ k√Ω hi·ªáu l√† $\\mathbb{Q}$." },
            { l: "nb", q: "S·ªë ƒë·ªëi c·ªßa s·ªë $-\\frac{5}{6}$ l√†:", options: ["$\\frac{5}{6}$", "$\\frac{6}{5}$", "$-\\frac{6}{5}$", "$0$"], correct: 0, exp: "S·ªë ƒë·ªëi c·ªßa $-a$ l√† $a$." },
            { l: "nb", q: "S·ªë n√†o sau ƒë√¢y l√† s·ªë h·ªØu t·ªâ d∆∞∆°ng?", options: ["$-2$", "$0$", "$\\frac{-1}{-3}$", "$\\frac{2}{-5}$"], correct: 2, exp: "$\\frac{-1}{-3} = \\frac{1}{3} > 0$." },
            { l: "nb", q: "M·ªçi s·ªë nguy√™n $a$ ƒë·ªÅu c√≥ th·ªÉ vi·∫øt d∆∞·ªõi d·∫°ng:", options: ["$\\frac{a}{1}$", "$\\frac{1}{a}$", "$\\frac{a}{a}$", "$\\frac{0}{a}$"], correct: 0, exp: "$a = a/1$." },
            { l: "nb", q: "Kh·∫≥ng ƒë·ªãnh n√†o sau ƒë√¢y l√† ƒê√öNG?", options: ["$\\mathbb{Q} \\subset \\mathbb{Z}$", "$\\mathbb{Z} \\subset \\mathbb{Q}$", "$\\mathbb{Q} \\subset \\mathbb{N}$", "$\\mathbb{N} \\subset \\mathbb{Z}$ l√† sai"], correct: 1, exp: "S·ªë nguy√™n l√† con s·ªë h·ªØu t·ªâ." },
            { l: "nb", q: "S·ªë th·∫≠p ph√¢n $0,25$ vi·∫øt d∆∞·ªõi d·∫°ng ph√¢n s·ªë t·ªëi gi·∫£n l√†:", options: ["$\\frac{25}{100}$", "$\\frac{1}{4}$", "$\\frac{2}{5}$", "$\\frac{1}{2}$"], correct: 1, exp: "$0,25 = 1/4$." },
            { l: "th", q: "S·ªë h·ªØu t·ªâ n√†o sau ƒë√¢y n·∫±m b√™n tr√°i ƒëi·ªÉm $0$ tr√™n tr·ª•c s·ªë?", options: ["$1,5$", "$\\frac{3}{4}$", "$-\\frac{2}{3}$", "$2$"], correct: 2, exp: "S·ªë h·ªØu t·ªâ √¢m n·∫±m b√™n tr√°i ƒëi·ªÉm 0." },
            { l: "th", q: "K·∫øt qu·∫£ so s√°nh hai s·ªë $-0,5$ v√† $\\frac{1}{4}$ l√†:", options: ["$-0,5 > \\frac{1}{4}$", "$-0,5 < \\frac{1}{4}$", "$-0,5 = \\frac{1}{4}$", "Kh√¥ng so s√°nh"], correct: 1, exp: "S·ªë √¢m lu√¥n nh·ªè h∆°n s·ªë d∆∞∆°ng." },
            { l: "th", q: "S·ªë ƒë·ªëi c·ªßa h·ªón s·ªë $1\\frac{1}{2}$ l√†:", options: ["$-1,5$", "$\\frac{3}{2}$", "$-1\\frac{2}{1}$", "$1,5$"], correct: 0, exp: "$1,5$ c√≥ s·ªë ƒë·ªëi l√† $-1,5$." },
            { l: "th", q: "ƒêi·ªÉm $M$ tr√™n tr·ª•c s·ªë bi·ªÉu di·ªÖn s·ªë $\\frac{3}{4}$. Kho·∫£ng c√°ch t·ª´ $M$ ƒë·∫øn g·ªëc $O$ l√†:", options: ["$3$ ƒë∆°n v·ªã", "$4$ ƒë∆°n v·ªã", "$\\frac{3}{4}$ ƒë∆°n v·ªã", "$0,34$ ƒë∆°n v·ªã"], correct: 2, exp: "Kho·∫£ng c√°ch l√† tr·ªã tuy·ªát ƒë·ªëi." },
            { l: "th", q: "S·∫Øp x·∫øp tƒÉng d·∫ßn: $0; -1; \\frac{1}{2}$ l√†:", options: ["$0; -1; \\frac{1}{2}$", "$-1; 0; \\frac{1}{2}$", "$\\frac{1}{2}; 0; -1$", "$-1; \\frac{1}{2}; 0$"], correct: 1, exp: "$-1 < 0 < 0,5$." },
            { l: "vd", q: "S·ªë h·ªØu t·ªâ $x$ n·∫±m gi·ªØa $-1$ v√† $0$ l√†:", options: ["$\\frac{1}{2}$", "$-\\frac{3}{2}$", "$-\\frac{1}{4}$", "$-1,2$"], correct: 2, exp: "$-1 < -0,25 < 0$." },
            { l: "vd", q: "Tr√™n tr·ª•c s·ªë, ƒëi·ªÉm bi·ªÉu di·ªÖn $-2/3$ v√† $2/3$ c√≥ ƒë·∫∑c ƒëi·ªÉm:", options: ["C√πng ph√≠a O", "C√πng b√™n ph·∫£i", "ƒê·ªëi x·ª©ng qua O", "Tr√πng nhau"], correct: 2, exp: "Hai s·ªë ƒë·ªëi nhau ƒë·ªëi x·ª©ng qua g·ªëc O." },
            { l: "vd", q: "Trong c√°c ph√¢n s·ªë $\\frac{2}{3}; \\frac{4}{6}; \\frac{-2}{-3}; \\frac{6}{9}$, c√≥ bao nhi√™u s·ªë h·ªØu t·ªâ kh√°c nhau?", options: ["1", "2", "3", "4"], correct: 0, exp: "C·∫£ 4 ph√¢n s·ªë ƒë·ªÅu b·∫±ng $2/3$ n√™n ch·ªâ l√† 1 s·ªë h·ªØu t·ªâ." },
            { l: "vd", q: "Cho $x = \\frac{a}{b}$. N·∫øu $a, b$ c√πng d·∫•u th√¨ $x$ l√†:", options: ["S·ªë h·ªØu t·ªâ d∆∞∆°ng", "S·ªë h·ªØu t·ªâ √¢m", "S·ªë 0", "Kh√¥ng x√°c ƒë·ªãnh"], correct: 0, exp: "C√πng d·∫•u th√¨ th∆∞∆°ng d∆∞∆°ng." }
        ];

        const ORIGINAL_TF = [
            { q: "C√¢u 1: V·ªÅ kh√°i ni·ªám s·ªë h·ªØu t·ªâ", items: [
                { t: "a) S·ªë t·ª± nhi√™n l√† s·ªë h·ªØu t·ªâ.", a: true, exp: "$n = n/1$." },
                { t: "b) S·ªë 0 l√† s·ªë h·ªØu t·ªâ d∆∞∆°ng.", a: false, exp: "S·ªë 0 kh√¥ng √¢m kh√¥ng d∆∞∆°ng." },
                { t: "c) $-1,5$ l√† s·ªë h·ªØu t·ªâ.", a: true, exp: "$-1,5 = -3/2$." },
                { t: "d) T·∫≠p s·ªë h·ªØu t·ªâ k√Ω hi·ªáu l√† $\\mathbb{Q}$.", a: true, exp: "ƒê√∫ng." }
            ]},
            { q: "C√¢u 2: V·ªÅ tr·ª•c s·ªë v√† s·ªë ƒë·ªëi", items: [
                { t: "a) $-2$ n·∫±m b√™n tr√°i $-3$ tr√™n tr·ª•c s·ªë.", a: false, exp: "$-2 > -3$ n√™n n·∫±m b√™n ph·∫£i." },
                { t: "b) G·ªëc $O$ n·∫±m gi·ªØa s·ªë √¢m v√† s·ªë d∆∞∆°ng.", a: true, exp: "ƒê√∫ng." },
                { t: "c) Kho·∫£ng c√°ch t·ª´ g·ªëc $O$ ƒë·∫øn ƒëi·ªÉm bi·ªÉu di·ªÖn s·ªë $1$ l√† $1$.", a: true, exp: "ƒê√∫ng." },
                { t: "d) Hai s·ªë ƒë·ªëi c√°ch ƒë·ªÅu ƒëi·ªÉm $O$.", a: true, exp: "ƒê√∫ng." }
            ]},
            { q: "C√¢u 3: V·ªÅ so s√°nh s·ªë h·ªØu t·ªâ", items: [
                { t: "a) $-0,75 = -\\frac{3}{4}$.", a: true, exp: "ƒê√∫ng." },
                { t: "b) $\\frac{1}{2} < \\frac{1}{3}$.", a: false, exp: "Sai, $0,5 > 0,33$." },
                { t: "c) S·ªë h·ªØu t·ªâ d∆∞∆°ng lu√¥n l·ªõn h∆°n s·ªë h·ªØu t·ªâ √¢m.", a: true, exp: "ƒê√∫ng." },
                { t: "d) S·ªë h·ªØu t·ªâ √¢m l·ªõn h∆°n $0$.", a: false, exp: "S·ªë h·ªØu t·ªâ √¢m lu√¥n nh·ªè h∆°n 0." }
            ]},
            { q: "C√¢u 4: V·ªÅ bi·ªÉu di·ªÖn tr√™n tr·ª•c s·ªë", items: [
                { t: "a) M·ªói s·ªë h·ªØu t·ªâ ch·ªâ c√≥ 1 ƒëi·ªÉm bi·ªÉu di·ªÖn duy nh·∫•t.", a: true, exp: "M·ªói s·ªë t∆∞∆°ng ·ª©ng duy nh·∫•t 1 ƒëi·ªÉm." },
                { t: "b) ƒêi·ªÉm $\\frac{1}{2}$ n·∫±m ch√≠nh gi·ªØa $0$ v√† $1$.", a: true, exp: "ƒê√∫ng." },
                { t: "c) ƒêi·ªÉm $-1$ c√°ch $O$ m·ªôt kho·∫£ng l√† $-1$.", a: false, exp: "Kho·∫£ng c√°ch ph·∫£i d∆∞∆°ng (b·∫±ng 1)." },
                { t: "d) Tr·ª•c s·ªë n·∫±m ngang c√≥ chi·ªÅu d∆∞∆°ng t·ª´ tr√°i sang ph·∫£i.", a: true, exp: "Quy ∆∞·ªõc chu·∫©n." }
            ]},
            { q: "C√¢u 5: V·ªÅ s·ªë ƒë·ªëi n√¢ng cao", items: [
                { t: "a) S·ªë ƒë·ªëi c·ªßa s·ªë $0$ l√† ch√≠nh n√≥.", a: true, exp: "$-0 = 0$." },
                { t: "b) S·ªë ƒë·ªëi c·ªßa s·ªë ƒë·ªëi c·ªßa s·ªë h·ªØu t·ªâ $a$ l√† ch√≠nh n√≥.", a: true, exp: "$-(-a) = a$." },
                { t: "c) Hai s·ªë ƒë·ªëi nhau lu√¥n c√≥ t·ªïng b·∫±ng $1$.", a: false, exp: "T·ªïng lu√¥n b·∫±ng 0." },
                { t: "d) S·ªë ƒë·ªëi c·ªßa m·ªôt s·ªë h·ªØu t·ªâ d∆∞∆°ng l√† m·ªôt s·ªë d∆∞∆°ng.", a: false, exp: "S·ªë ƒë·ªëi c·ªßa s·ªë d∆∞∆°ng l√† s·ªë √¢m." }
            ]}
        ];

        const ORIGINAL_FILL = [
            { q: "S·ªë ƒë·ªëi c·ªßa s·ªë $2,5$ l√†:", a: "-2,5", exp: "ƒê·ªïi d·∫•u s·ªë h·ªØu t·ªâ." },
            { q: "S·ªë h·ªØu t·ªâ kh√¥ng d∆∞∆°ng c≈©ng kh√¥ng √¢m l√† s·ªë:", a: "0", exp: "ƒê√≥ l√† s·ªë 0." },
            { q: "Vi·∫øt $-0,6$ d∆∞·ªõi d·∫°ng ph√¢n s·ªë t·ªëi gi·∫£n l√†:", a: "-3/5", exp: "$-6/10 = -3/5$." },
            { q: "ƒêi·ªÉm bi·ªÉu di·ªÖn s·ªë $-\\frac{1}{2}$ c√°ch g·ªëc $O$ bao nhi√™u ƒë∆°n v·ªã?", a: "0,5", exp: "Kho·∫£ng c√°ch $|-1/2| = 0,5$." },
            { q: "T·∫≠p h·ª£p c√°c s·ªë h·ªØu t·ªâ ƒë∆∞·ª£c k√Ω hi·ªáu b·∫±ng ch·ªØ c√°i n√†o?", a: "Q", exp: "K√Ω hi·ªáu l√† Q." }
        ];

        let currentMcq = [...ORIGINAL_MCQ];
        let currentTf = [...ORIGINAL_TF];
        let currentFill = [...ORIGINAL_FILL];

        let userMcq = Array(15).fill(null);
        let userTf = Array(5).fill(null).map(() => Array(4).fill(null));
        let isSubmitted = false;

        function init() {
            renderAll();
        }

        // --- H√ÄM CHO PH·∫¶N KH·ªûI ƒê·ªòNG M·ªöI ---
        function unlockGift() {
            const input = document.getElementById('warmup-input').value.trim();
            if(input === "0") {
                document.getElementById('warmup-task').classList.add('hidden');
                document.getElementById('gift-section').classList.remove('hidden');
                confetti({ particleCount: 50, spread: 60, origin: { y: 0.3 } });
            } else {
                alert("G·∫ßn ƒë√∫ng r·ªìi, h√£y th·ª≠ l·∫°i nh√©! G·ª£i √Ω: S·ªë n√†y n·∫±m gi·ªØa -1 v√† 1.");
            }
        }

        function openGift() {
            document.getElementById('gift-section').classList.add('hidden');
            document.getElementById('reward-content').classList.remove('hidden');
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.3 }, colors: ['#FFD700', '#FFA500'] });
        }
        // ----------------------------------

        function renderAll() {
            const mcqBox = document.getElementById('mcq-container');
            mcqBox.innerHTML = "";
            currentMcq.forEach((d, i) => {
                let opts = d.options.map((o, j) => `<div onclick="setMcq(${i},${j})" id="mcq-${i}-${j}" class="mcq-option p-4 bg-white shadow-sm flex items-center mb-2"><span class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 mr-3 font-bold text-xs">${String.fromCharCode(65+j)}</span> ${o}</div>`).join('');
                mcqBox.innerHTML += `<div class="p-5 border-b" id="mcq-card-${i}"><div class="flex justify-between mb-2"><span class="font-bold text-blue-600">C√ÇU ${i+1}</span></div><p class="mb-4 text-slate-700 font-medium">${d.q}</p><div class="grid grid-cols-1 md:grid-cols-2 gap-3">${opts}</div><div id="mcq-fb-${i}" class="feedback-box"></div></div>`;
            });

            const tfBox = document.getElementById('tf-container');
            tfBox.innerHTML = "";
            currentTf.forEach((d, i) => {
                let rows = d.items.map((item, j) => `<tr class="border-b"><td class="py-4 px-4 text-sm font-medium">${item.t}<div id="tf-fb-${i}-${j}" class="feedback-box"></div></td><td class="p-2 text-center"><button onclick="setTf(${i},${j},true)" id="tf-btn-${i}-${j}-t" class="check-btn w-10 h-10 rounded-xl border">ƒê</button></td><td class="p-2 text-center"><button onclick="setTf(${i},${j},false)" id="tf-btn-${i}-${j}-s" class="check-btn w-10 h-10 rounded-xl border">S</button></td></tr>`).join('');
                tfBox.innerHTML += `<div class="bg-slate-50 rounded-2xl border overflow-hidden mb-8"><div class="bg-white p-4 font-bold text-blue-800 border-b">${d.q}</div><table class="w-full"><tbody>${rows}</tbody></table></div>`;
            });

            const fBox = document.getElementById('fill-container');
            fBox.innerHTML = "";
            currentFill.forEach((d, i) => {
                fBox.innerHTML += `<div class="bg-slate-50 p-5 rounded-2xl border space-y-2"><div class="flex items-center justify-between gap-4"><span><strong>C√¢u ${i+1}.</strong> ${d.q}</span><input type="text" id="fill-${i}" class="fill-input"></div><div id="fill-fb-${i}" class="feedback-box"></div></div>`;
            });
            
            userMcq = Array(currentMcq.length).fill(null);
            userTf = Array(currentTf.length).fill(null).map(() => Array(4).fill(null));
            isSubmitted = false;
            document.getElementById('submit-btn').classList.remove('hidden');
            document.getElementById('result-board').classList.add('hidden');
            
            if(window.MathJax) MathJax.typeset();
        }

        async function downloadAsImage(elementId, fileName) {
            const element = document.getElementById(elementId);
            const canvas = await html2canvas(element, { 
                scale: 2,
                backgroundColor: "#ffffff",
                logging: false,
                useCORS: true 
            });
            const link = document.createElement('a');
            link.download = fileName + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function setMcq(q, o) { 
            if(!isSubmitted) { 
                userMcq[q] = o; 
                document.getElementById(`mcq-card-${q}`).querySelectorAll('.mcq-option').forEach(opt => opt.classList.remove('selected')); 
                document.getElementById(`mcq-${q}-${o}`).classList.add('selected'); 
            } 
        }

        function setTf(q, i, v) { 
            if(!isSubmitted) { 
                userTf[q][i] = v; 
                document.getElementById(`tf-btn-${q}-${i}-t`).classList.remove('selected-true'); 
                document.getElementById(`tf-btn-${q}-${i}-s`).classList.remove('selected-false'); 
                if(v) document.getElementById(`tf-btn-${q}-${i}-t`).classList.add('selected-true'); 
                else document.getElementById(`tf-btn-${q}-${i}-s`).classList.add('selected-false'); 
            } 
        }

        function checkResults() {
            isSubmitted = true;
            let correct = 0;
            let total = currentMcq.length + (currentTf.length * 4) + currentFill.length;

            currentMcq.forEach((d, i) => {
                const fb = document.getElementById(`mcq-fb-${i}`);
                const opts = document.getElementById(`mcq-card-${i}`).querySelectorAll('.mcq-option');
                opts[d.correct].classList.add('correct');
                if(userMcq[i] === d.correct) { correct++; fb.innerHTML = "‚úîÔ∏è " + d.exp; fb.className = "feedback-box block text-green-700 bg-green-50"; }
                else { if(userMcq[i] !== null) opts[userMcq[i]].classList.add('wrong'); fb.innerHTML = "‚ùå " + d.exp; fb.className = "feedback-box block text-red-700 bg-red-50"; }
            });

            currentTf.forEach((d, i) => { d.items.forEach((item, j) => {
                const fb = document.getElementById(`tf-fb-${i}-${j}`);
                if(userTf[i][j] === item.a) { correct++; fb.innerHTML = "‚úîÔ∏è " + item.exp; fb.className = "feedback-box block text-green-700 bg-green-50"; }
                else { fb.innerHTML = "‚ùå " + item.exp; fb.className = "feedback-box block text-red-700 bg-red-50"; }
                if(item.a) document.getElementById(`tf-btn-${i}-${j}-t`).classList.add('correct-highlight'); else document.getElementById(`tf-btn-${i}-${j}-s`).classList.add('correct-highlight');
            });});

            currentFill.forEach((d, i) => {
                const input = document.getElementById(`fill-${i}`);
                const fb = document.getElementById(`fill-fb-${i}`);
                if(input.value.trim().toLowerCase() === d.a.toLowerCase()) { correct++; input.classList.add('fill-correct'); fb.innerHTML = "‚úîÔ∏è " + d.exp; fb.className = "feedback-box block text-green-700 bg-green-50"; }
                else { input.classList.add('fill-wrong'); fb.innerHTML = "‚ùå ƒê√°p √°n: " + d.a; fb.className = "feedback-box block text-red-700 bg-red-50"; }
            });

            document.getElementById('submit-btn').classList.add('hidden');
            document.getElementById('result-board').classList.remove('hidden');
            document.getElementById('score-text').innerText = `K·∫æT QU·∫¢: ${((correct/total)*10).toFixed(1)}/10`;
            confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
            if(window.MathJax) MathJax.typeset();
        }

        function generateNewLevel(type) {
            document.getElementById('loading-overlay').style.display = 'flex';
            setTimeout(() => {
                if(type === 'similar') {
                    currentMcq = [...ORIGINAL_MCQ].sort(() => Math.random() - 0.5);
                    currentFill = ORIGINAL_FILL.map(item => ({...item, q: item.q.replace("2,5", "3,5").replace("-0,6", "-0,8"), a: item.a.replace("-2,5", "-3,5").replace("-3/5", "-4/5")}));
                } else if(type === 'advanced') {
                    currentMcq = [
                        { l: "v dc", q: "T√¨m x bi·∫øt $|x - 1,5| = 2$ v√† $x < 0$:", options: ["$3,5$", "$-0,5$", "$0,5$", "$-3,5$"], correct: 1, exp: "Gi·∫£i pt tr·ªã tuy·ªát ƒë·ªëi, ch·ªçn nghi·ªám √¢m." },
                        ...ORIGINAL_MCQ.slice(5) 
                    ];
                    currentFill = [
                        { q: "S·ªë h·ªØu t·ªâ nh·ªè nh·∫•t trong c√°c s·ªë: $0; -1/2; -3/4; -0,1$ l√†:", a: "-3/4", exp: "So s√°nh c√°c s·ªë h·ªØu t·ªâ √¢m." },
                        ...ORIGINAL_FILL.slice(1)
                    ];
                }
                document.getElementById('loading-overlay').style.display = 'none';
                renderAll();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 1500);
        }

        function downloadTextOffline() {
            let txt = "=== ƒê√ÅP √ÅN CHI TI·∫æT B√ÄI 1: S·ªê H·ªÆU T·ªà ===\n\n1. TR·∫ÆC NGHI·ªÜM:\n";
            currentMcq.forEach((d,i) => txt += `C√¢u ${i+1}: ${String.fromCharCode(65+d.correct)} (${d.exp})\n`);
            txt += "\n2. ƒê√öNG/SAI:\n";
            currentTf.forEach(d => { txt += d.q + "\n"; d.items.forEach(it => txt += `- ${it.t}: ${it.a ? 'ƒê√∫ng' : 'Sai'} (${it.exp})\n`); });
            txt += "\n3. TR·∫¢ L·ªúI NG·∫ÆN:\n";
            currentFill.forEach((d,i) => txt += `C√¢u ${i+1}: ${d.a} (${d.exp})\n`);
            
            const blob = new Blob([txt], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = "Dap_An_Bai_1_Toan_7.txt";
            a.click();
        }

        window.onload = init;
    </script>
</body>
</html>