<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i 1: T·∫≠p h·ª£p s·ªë h·ªØu t·ªâ - N√¢ng c·∫•p</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
    <script>
        window.MathJax = {
            tex: { 
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            chtml: {
                scale: 1,
                matchFontHeight: false,
                mtextInheritFont: true
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" async></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        body { font-family: 'Comfortaa', cursive !important; scroll-behavior: smooth; line-height: 1.8; }
        * { font-family: 'Comfortaa', cursive !important; }
        
        mjx-container {
            display: inline-block !important;
            vertical-align: baseline !important;
            margin: 0 0.1em !important;
        }
        
        nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .section-dashed {
            border: 3px dashed #cbd5e1;
            border-radius: 24px;
            transition: border-color 0.3s;
        }
        .section-dashed:hover { border-color: #3b82f6; }

        .check-btn { transition: all 0.2s; cursor: pointer; border: 2px solid #e2e8f0; }
        .selected-true { background-color: #22c55e !important; color: white !important; border-color: #16a34a !important; }
        .selected-false { background-color: #ef4444 !important; color: white !important; border-color: #dc2626 !important; }
        .correct-highlight { border: 3px solid #22c55e !important; box-shadow: 0 0 8px rgba(34, 197, 94, 0.4); }
        
        .mcq-option { border: 2px solid #e2e8f0; cursor: pointer; transition: all 0.2s; border-radius: 16px; }
        .mcq-option.selected { border-color: #3b82f6; background-color: #eff6ff; }
        .mcq-option.correct { border-color: #22c55e; background-color: #dcfce7; color: #166534; }
        .mcq-option.wrong { border-color: #ef4444; background-color: #fee2e2; color: #991b1b; }
        
        .fill-input { border-bottom: 2px dashed #3b82f6; outline: none; text-align: center; width: 120px; font-weight: bold; color: #2563eb; background: transparent; }
        .fill-correct { background-color: #dcfce7; border-color: #22c55e; border-style: solid; }
        .fill-wrong { background-color: #fee2e2; border-color: #ef4444; border-style: solid; }
        
        .feedback-box { display: none; margin-top: 0.5rem; padding: 0.75rem; border-radius: 0.75rem; border-left: 4px solid #ef4444; background-color: #fffafb; font-size: 0.85rem; }

        .hint-box { 
            display: none; 
            margin-top: 0.5rem; 
            padding: 0.75rem; 
            border-radius: 0.75rem; 
            border: 1px dashed #eab308; 
            background-color: #fefce8; 
            color: #854d0e; 
            font-size: 0.85rem;
        }

        .btn-download { background-color: #4f46e5; color: white; padding: 6px 12px; border-radius: 99px; font-size: 0.75rem; font-weight: bold; display: flex; align-items: center; gap: 4px; transition: opacity 0.2s; }
        .btn-download:hover { opacity: 0.9; }

        #loading-overlay { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 100; flex-direction: column; align-items: center; justify-content: center; }
        .loader { border: 6px solid #f3f3f3; border-top: 6px solid #3b82f6; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .warmup-input-refined {
            width: 140px; padding: 10px; text-align: center; font-size: 1rem; font-weight: 700; border-radius: 15px; border: 2px solid #3b82f6; background: #f0f7ff; color: #1e40af; outline: none; transition: all 0.3s;
        }

        .hint-btn { 
            display: inline-flex; 
            align-items: center; 
            gap: 4px; 
            background: #fef3c7; 
            border: 2px solid #f59e0b; 
            padding: 6px 12px; 
            border-radius: 12px; 
            color: #92400e; 
            font-size: 0.75rem; 
            font-weight: bold; 
            transition: all 0.2s;
            margin-left: 8px;
            cursor: pointer;
        }
        .hint-btn:hover {
            background: #fde68a;
            transform: translateY(-1px);
        }

        @keyframes bounce-in {
            0% { transform: scale(0.9); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-bounce-in {
            animation: bounce-in 0.5s ease-out;
        }

        .level-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
        }
        .level-nhan-biet {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
        .level-thong-hieu {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        .level-van-dung {
            background: #fecaca;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .score-excellent {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            animation: pulse-scale 1s ease-in-out infinite;
        }
        .score-good {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        .score-average {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        .score-low {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        @keyframes pulse-scale {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .download-btn {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            color: white;
            padding: 10px 20px;
            border-radius: 16px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            font-size: 0.875rem;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
        }

        .download-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-24 text-slate-800">

    <nav class="p-4 shadow-sm mb-6">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <a href="#" class="flex items-center gap-2 text-orange-600 font-bold hover:opacity-80 transition-opacity">
                <span class="text-xl">üè†</span>
                <span class="hidden sm:inline">Trang ch·ªß</span>
            </a>
            <div class="text-xs font-bold text-slate-500 uppercase tracking-widest">To√°n 7 - B√†i 1 ‚ú®</div>
        </div>
    </nav>

    <div id="loading-overlay">
        <div class="loader mb-4"></div>
        <p class="font-bold text-blue-600 animate-pulse">ƒêang t·∫°o ƒë·ªÅ m·ªõi...</p>
    </div>

    <div class="max-w-4xl mx-auto px-3 md:px-6 space-y-12">
        
        <div class="text-center py-6">
            <h1 class="text-3xl md:text-4xl font-black text-blue-600 uppercase tracking-tighter flex items-center justify-center gap-3 flex-wrap">
                <span>üìê</span> B√†i 1: T·∫≠p h·ª£p s·ªë h·ªØu t·ªâ <span>‚úèÔ∏è</span>
            </h1>
            <p class="text-slate-500 font-bold mt-2">K·∫øt n·ªëi tri th·ª©c - To√°n 7</p>
        </div>

        <!-- KI·∫æN TH·ª®C -->
        <div id="capture-knowledge" class="bg-white p-6 section-dashed shadow-sm">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-blue-800">üìñ Ki·∫øn Th·ª©c Tr·ªçng T√¢m</h2>
                <button onclick="downloadKnowledgePDF()" class="download-btn">
                    <span>üì•</span> T·∫£i Offline
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div class="bg-blue-50/50 p-5 rounded-2xl border border-blue-100 space-y-3">
                    <h3 class="font-bold text-blue-700">1. Kh√°i ni·ªám s·ªë h·ªØu t·ªâ</h3>
                    <ul class="space-y-2 text-slate-600">
                        <li>‚Ä¢ S·ªë vi·∫øt d·∫°ng $\frac{a}{b}$ ($a, b \in \mathbb{Z}, b \neq 0$)</li>
                        <li>‚Ä¢ T·∫≠p h·ª£p k√Ω hi·ªáu: $\mathbb{Q}$</li>
                    </ul>
                </div>
                <div class="bg-green-50/50 p-5 rounded-2xl border border-green-100 space-y-3">
                    <h3 class="font-bold text-green-700">2. Th·ª© t·ª± v√† Tr·ª•c s·ªë</h3>
                    <ul class="space-y-2 text-slate-600">
                        <li>‚Ä¢ Bi·ªÉu di·ªÖn tr√™n tr·ª•c s·ªë</li>
                        <li>‚Ä¢ S·ªë ƒë·ªëi: $-a$. T·ªïng = 0</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- PH√Å BƒÇNG -->
        <div class="bg-white p-8 section-dashed shadow-md">
            <div id="warmup-task">
                <h2 class="text-2xl font-black text-blue-600 flex items-center gap-3 mb-4">
                    <span class="text-3xl">üßä</span> NHI·ªÜM V·ª§ PH√Å BƒÇNG
                </h2>
                <p class="text-slate-600 mb-6 font-medium">Gi·∫£i m√£ ƒë·ªÉ m·ªü <strong>H·ªôp Qu√†</strong>:</p>
                <div class="bg-blue-50 p-6 rounded-3xl border-2 border-blue-100 mb-6">
                    <p class="text-lg font-bold text-blue-800 text-center">
                        "T√¥i kh√¥ng d∆∞∆°ng, c≈©ng kh√¥ng √¢m. T√¥i l√† s·ªë n√†o?"
                    </p>
                    <div class="mt-6 flex flex-col items-center gap-4">
                        <input type="text" id="warmup-input" placeholder="Nh·∫≠p s·ªë" class="warmup-input-refined">
                        <button onclick="unlockGift()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-8 rounded-xl transition-all shadow-lg active:scale-95">
                            GI·∫¢I M√É üöÄ
                        </button>
                    </div>
                </div>
            </div>
            <div id="gift-section" class="hidden flex flex-col items-center animate-bounce-in">
                <div class="text-7xl mb-4 cursor-pointer" onclick="openGift()">üéÅ</div>
                <h3 class="text-xl font-bold text-orange-600">M·ªû KH√ìA TH√ÄNH C√îNG!</h3>
            </div>
            <div id="reward-content" class="hidden text-center space-y-4 py-4">
                <h3 class="text-2xl font-black text-green-600">CH√öC M·ª™NG! üéâ</h3>
                <p class="text-blue-600 font-bold animate-pulse">S·∫µn s√†ng l√†m b√†i! üëá</p>
            </div>
        </div>

        <!-- MCQ -->
        <div id="capture-mcq" class="bg-white p-6 section-dashed shadow-sm">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-xl font-bold text-blue-800 uppercase">üìù PH·∫¶N 1: Tr·∫Øc nghi·ªám (15 c√¢u)</h2>
                <button onclick="downloadExamPDF()" class="download-btn">
                    <span>üì•</span> T·∫£i ƒê·ªÅ
                </button>
            </div>
            <div id="mcq-container" class="space-y-8"></div>
        </div>

        <!-- T/F -->
        <div id="capture-tf" class="bg-white p-6 section-dashed shadow-sm">
            <h2 class="text-xl font-bold text-blue-800 uppercase mb-8">‚úîÔ∏è PH·∫¶N 2: ƒê√∫ng/Sai (5 c√¢u)</h2>
            <div id="tf-container" class="space-y-10"></div>
        </div>

        <!-- FILL -->
        <div id="capture-fill" class="bg-white p-6 section-dashed shadow-sm">
            <h2 class="text-xl font-bold text-blue-800 uppercase mb-8">üñãÔ∏è PH·∫¶N 3: ƒêi·ªÅn ƒë√°p √°n (5 c√¢u)</h2>
            <div id="fill-container" class="space-y-6"></div>
        </div>

        <!-- N·ªòP B√ÄI -->
        <div class="text-center py-12">
            <button id="submit-btn" onclick="checkResults()" class="bg-blue-600 hover:bg-blue-700 text-white font-black py-5 px-16 rounded-full shadow-2xl transition-all active:scale-95 text-xl tracking-widest flex items-center gap-4 mx-auto">
                <span>üì§</span> N·ªòP B√ÄI
            </button>
            <div id="result-board" class="mt-8 hidden">
                <div class="bg-white section-dashed p-8 inline-block shadow-xl w-full max-w-2xl">
                    <div id="score-text" class="text-4xl font-black mb-2 p-6 rounded-2xl"></div>
                    <div id="score-message" class="text-lg font-bold mt-4"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const QUESTION_BANK = {
            nb: [
                {
                    q: "T·∫≠p h·ª£p s·ªë h·ªØu t·ªâ k√Ω hi·ªáu:",
                    opts: ["$\\mathbb{N}$", "$\\mathbb{Z}$", "$\\mathbb{Q}$", "$\\mathbb{R}$"],
                    ans: 2,
                    exp: "$\\mathbb{Q}$ (Quotient).",
                    hint: "Q = Quotient (th∆∞∆°ng)"
                },
                {
                    gen: () => {
                        const pairs = [["-\\frac{5}{6}", "\\frac{5}{6}"], ["\\frac{3}{4}", "-\\frac{3}{4}"], ["-2{,}5", "2{,}5"], ["-\\frac{7}{8}", "\\frac{7}{8}"]];
                        const p = pairs[Math.floor(Math.random() * pairs.length)];
                        const opts = [`$${p[1]}$`, "$0$", "$1$", `$${p[0]}$`];
                        shuffle(opts);
                        return {
                            q: `S·ªë ƒë·ªëi c·ªßa $${p[0]}$:`,
                            opts: opts,
                            ans: opts.indexOf(`$${p[1]}$`),
                            exp: `S·ªë ƒë·ªëi c·ªßa $${p[0]}$ l√† $${p[1]}$.`,
                            hint: "ƒê·ªïi d·∫•u"
                        };
                    }
                },
                {
                    q: "M·ªçi s·ªë nguy√™n $a$ vi·∫øt d·∫°ng:",
                    opts: ["$\\frac{a}{1}$", "$\\frac{1}{a}$", "$\\frac{a}{a}$", "$\\frac{0}{a}$"],
                    ans: 0,
                    exp: "$a = \\frac{a}{1}$.",
                    hint: "Chia cho 1"
                },
                {
                    q: "S·ªë n√†o KH√îNG ph·∫£i s·ªë h·ªØu t·ªâ:",
                    opts: ["$\\sqrt{2}$", "$\\frac{-3}{4}$", "$0{,}25$", "$-5$"],
                    ans: 0,
                    exp: "$\\sqrt{2}$ l√† s·ªë v√¥ t·ªâ.",
                    hint: "CƒÉn b·∫≠c hai kh√¥ng ch√≠nh ph∆∞∆°ng"
                },
                {
                    gen: () => {
                        const fracs = [["\\frac{2}{5}", "0{,}4"], ["\\frac{3}{4}", "0{,}75"], ["\\frac{1}{2}", "0{,}5"]];
                        const f = fracs[Math.floor(Math.random() * fracs.length)];
                        return {
                            q: `$${f[0]}$ b·∫±ng s·ªë th·∫≠p ph√¢n:`,
                            opts: [`$${f[1]}$`, "$1$", "$0{,}2$", "$2$"],
                            ans: 0,
                            exp: `$${f[0]} = ${f[1]}$.`,
                            hint: "Chia t·ª≠ cho m·∫´u"
                        };
                    }
                }
            ],
            th: [
                {
                    gen: () => {
                        const negs = [["-\\frac{2}{3}", "√¢m 2/3"], ["-1{,}5", "√¢m 1,5"], ["-\\frac{5}{4}", "√¢m 5/4"]];
                        const n = negs[Math.floor(Math.random() * negs.length)];
                        const opts = [`$${n[0]}$`, "$\\frac{1}{2}$", "$1$", "$0$"];
                        shuffle(opts);
                        return {
                            q: "S·ªë n√†o b√™n tr√°i $0$ tr√™n tr·ª•c s·ªë:",
                            opts: opts,
                            ans: opts.indexOf(`$${n[0]}$`),
                            exp: "S·ªë √¢m < 0.",
                            hint: "S·ªë √¢m n·∫±m tr√°i"
                        };
                    }
                },
                {
                    q: "So s√°nh $-\\frac{1}{3}$ v√† $-\\frac{1}{2}$:",
                    opts: ["$-\\frac{1}{3} > -\\frac{1}{2}$", "$-\\frac{1}{3} < -\\frac{1}{2}$", "$-\\frac{1}{3} = -\\frac{1}{2}$", "Kh√¥ng so s√°nh ƒë∆∞·ª£c"],
                    ans: 0,
                    exp: "$-\\frac{1}{3} \\approx -0{,}33 > -0{,}5 = -\\frac{1}{2}$.",
                    hint: "ƒê·ªïi th·∫≠p ph√¢n ho·∫∑c quy ƒë·ªìng"
                },
                {
                    gen: () => {
                        const comps = [
                            ["\\frac{2}{5}", "\\frac{3}{5}", "<"],
                            ["\\frac{5}{6}", "\\frac{2}{3}", ">"],
                            ["-\\frac{3}{4}", "-\\frac{1}{2}", "<"]
                        ];
                        const c = comps[Math.floor(Math.random() * comps.length)];
                        return {
                            q: `So s√°nh $${c[0]}$ v√† $${c[1]}$:`,
                            opts: [`$${c[0]} ${c[2]} ${c[1]}$`, `$${c[0]} = ${c[1]}$`, `$${c[0]} ${c[2] === '<' ? '>' : '<'} ${c[1]}$`, "Kh√¥ng x√°c ƒë·ªãnh"],
                            ans: 0,
                            exp: `Quy ƒë·ªìng ho·∫∑c so s√°nh th·∫≠p ph√¢n.`,
                            hint: "C√πng m·∫´u ho·∫∑c ƒë·ªïi th·∫≠p ph√¢n"
                        };
                    }
                }
            ],
            vd: [
                {
                    q: "S·ªë $x$ n·∫±m gi·ªØa $-1$ v√† $0$:",
                    opts: ["$-\\frac{1}{2}$", "$\\frac{1}{2}$", "$-2$", "$1$"],
                    ans: 0,
                    exp: "$-1 < -\\frac{1}{2} < 0$.",
                    hint: "S·ªë √¢m, $|x| < 1$"
                },
                {
                    q: "Cho $a < b < 0$. Kh·∫≥ng ƒë·ªãnh ƒë√∫ng:",
                    opts: ["$|a| > |b|$", "$|a| < |b|$", "$|a| = |b|$", "$a > b$"],
                    ans: 0,
                    exp: "S·ªë √¢m c√†ng nh·ªè th√¨ tr·ªã tuy·ªát ƒë·ªëi c√†ng l·ªõn.",
                    hint: "Xa 0 h∆°n"
                },
                {
                    gen: () => {
                        const ranges = [
                            ["0", "1", "\\frac{1}{3}"],
                            ["-1", "0", "-\\frac{2}{3}"],
                            ["\\frac{1}{2}", "1", "\\frac{3}{4}"]
                        ];
                        const r = ranges[Math.floor(Math.random() * ranges.length)];
                        return {
                            q: `S·ªë n√†o n·∫±m gi·ªØa $${r[0]}$ v√† $${r[1]}$:`,
                            opts: [`$${r[2]}$`, "$2$", "$-3$", "$5$"],
                            ans: 0,
                            exp: `$${r[0]} < ${r[2]} < ${r[1]}$.`,
                            hint: "Ki·ªÉm tra t·ª´ng ƒë√°p √°n"
                        };
                    }
                }
            ]
        };

        // M·ªû R·ªòNG NG√ÇN H√ÄNG C√ÇU H·ªéI ƒê√öNG/SAI
        const TF_BANK = [
            {
                q: "C√¢u 1: Kh√°i ni·ªám",
                items: [
                    {t: "a) S·ªë t·ª± nhi√™n l√† s·ªë h·ªØu t·ªâ", a: true, exp: "$n = n/1$", h: "Vi·∫øt n/1"},
                    {t: "b) S·ªë 0 l√† s·ªë h·ªØu t·ªâ d∆∞∆°ng", a: false, exp: "0 kh√¥ng √¢m kh√¥ng d∆∞∆°ng", h: "S·ªë ƒë·∫∑c bi·ªát"},
                    {t: "c) $-1{,}5$ l√† s·ªë h·ªØu t·ªâ", a: true, exp: "$-1{,}5 = -3/2$", h: "Th·∫≠p ph√¢n h·ªØu h·∫°n"},
                    {t: "d) K√Ω hi·ªáu $\\mathbb{Q}$", a: true, exp: "ƒê√∫ng", h: "Xem k√Ω hi·ªáu"}
                ]
            },
            {
                q: "C√¢u 2: Tr·ª•c s·ªë",
                items: [
                    {t: "a) $-2$ tr√°i $-3$", a: false, exp: "$-2 > -3$", h: "L·ªõn h∆°n n·∫±m ph·∫£i"},
                    {t: "b) $O$ gi·ªØa √¢m v√† d∆∞∆°ng", a: true, exp: "ƒê√∫ng", h: "ƒêi·ªÉm 0"},
                    {t: "c) Kho·∫£ng c√°ch $O$ ƒë·∫øn $1$ = $1$", a: true, exp: "ƒê√∫ng", h: "ƒê∆°n v·ªã"},
                    {t: "d) Hai s·ªë ƒë·ªëi c√°ch ƒë·ªÅu $O$", a: true, exp: "ƒê√∫ng", h: "T√≠nh ch·∫•t"}
                ]
            },
            {
                q: "C√¢u 3: So s√°nh",
                items: [
                    {t: "a) $-0{,}75 = -\\frac{3}{4}$", a: true, exp: "ƒê√∫ng", h: "ƒê·ªïi th·∫≠p ph√¢n"},
                    {t: "b) $\\frac{1}{2} < \\frac{1}{3}$", a: false, exp: "$0{,}5 > 0{,}33$", h: "Quy ƒë·ªìng"},
                    {t: "c) D∆∞∆°ng > √¢m", a: true, exp: "ƒê√∫ng", h: "So s√°nh d·∫•u"},
                    {t: "d) √Çm > $0$", a: false, exp: "√Çm < 0", h: "ƒê·ªãnh nghƒ©a"}
                ]
            },
            {
                q: "C√¢u 4: Bi·ªÉu di·ªÖn",
                items: [
                    {t: "a) M·ªói s·ªë 1 ƒëi·ªÉm duy nh·∫•t", a: true, exp: "ƒê√∫ng", h: "Nguy√™n t·∫Øc"},
                    {t: "b) $\\frac{1}{2}$ gi·ªØa $0$ v√† $1$", a: true, exp: "ƒê√∫ng", h: "Trung ƒëi·ªÉm"},
                    {t: "c) ƒêi·ªÉm $-1$ c√°ch $O$ = $-1$", a: false, exp: "Kho·∫£ng c√°ch = 1", h: "Kh√¥ng √¢m"},
                    {t: "d) Chi·ªÅu d∆∞∆°ng tr√°i‚Üíph·∫£i", a: true, exp: "Quy ∆∞·ªõc", h: "Chi·ªÅu"}
                ]
            },
            {
                q: "C√¢u 5: S·ªë ƒë·ªëi",
                items: [
                    {t: "a) S·ªë ƒë·ªëi c·ªßa $0$ = $0$", a: true, exp: "$-0 = 0$", h: "ƒê·∫∑c bi·ªát"},
                    {t: "b) $-(-a) = a$", a: true, exp: "ƒê√∫ng", h: "Quy t·∫Øc d·∫•u"},
                    {t: "c) T·ªïng = $1$", a: false, exp: "T·ªïng = 0", h: "ƒê·∫∑c ƒëi·ªÉm"},
                    {t: "d) ƒê·ªëi c·ªßa d∆∞∆°ng = d∆∞∆°ng", a: false, exp: "= √¢m", h: "ƒê·ªïi d·∫•u"}
                ]
            },
            {
                q: "C√¢u 6: Ph√¢n s·ªë",
                items: [
                    {t: "a) $\\frac{2}{3} = \\frac{4}{6}$", a: true, exp: "Nh√¢n c·∫£ t·ª≠ v√† m·∫´u cho 2", h: "Ph√¢n s·ªë b·∫±ng nhau"},
                    {t: "b) $\\frac{-5}{7}$ l√† s·ªë h·ªØu t·ªâ √¢m", a: true, exp: "T·ª≠ √¢m, m·∫´u d∆∞∆°ng", h: "D·∫•u ph√¢n s·ªë"},
                    {t: "c) $\\frac{0}{5} = 0$", a: true, exp: "T·ª≠ = 0", h: "Ph√¢n s·ªë b·∫±ng 0"},
                    {t: "d) $\\frac{3}{0}$ l√† s·ªë h·ªØu t·ªâ", a: false, exp: "M·∫´u ‚â† 0", h: "ƒêi·ªÅu ki·ªán"}
                ]
            },
            {
                q: "C√¢u 7: Th·∫≠p ph√¢n",
                items: [
                    {t: "a) $0{,}333... = \\frac{1}{3}$", a: true, exp: "Th·∫≠p ph√¢n v√¥ h·∫°n tu·∫ßn ho√†n", h: "Chu k·ª≥"},
                    {t: "b) M·ªçi s·ªë th·∫≠p ph√¢n h·ªØu h·∫°n l√† s·ªë h·ªØu t·ªâ", a: true, exp: "Vi·∫øt d·∫°ng ph√¢n s·ªë", h: "H·ªØu h·∫°n ‚Üí h·ªØu t·ªâ"},
                    {t: "c) $\\pi$ l√† s·ªë h·ªØu t·ªâ", a: false, exp: "$\\pi$ v√¥ t·ªâ", h: "S·ªë ƒë·∫∑c bi·ªát"},
                    {t: "d) $0{,}5 = \\frac{1}{2}$", a: true, exp: "ƒê√∫ng", h: "ƒê·ªïi ƒë∆°n gi·∫£n"}
                ]
            },
            {
                q: "C√¢u 8: Quan h·ªá t·∫≠p h·ª£p",
                items: [
                    {t: "a) $\\mathbb{N} \\subset \\mathbb{Q}$", a: true, exp: "T·ª± nhi√™n l√† h·ªØu t·ªâ", h: "T·∫≠p con"},
                    {t: "b) $\\mathbb{Z} \\subset \\mathbb{Q}$", a: true, exp: "Nguy√™n l√† h·ªØu t·ªâ", h: "T·∫≠p con"},
                    {t: "c) $\\mathbb{Q} \\subset \\mathbb{N}$", a: false, exp: "Ng∆∞·ª£c l·∫°i", h: "Chi·ªÅu quan h·ªá"},
                    {t: "d) $-3 \\in \\mathbb{Q}$", a: true, exp: "$-3 = -3/1$", h: "Thu·ªôc"}
                ]
            }
        ];

        // M·ªû R·ªòNG NG√ÇN H√ÄNG C√ÇU H·ªéI ƒêI·ªÄN ƒê√ÅP √ÅN
        const FILL_BANK = [
            {q: "S·ªë ƒë·ªëi c·ªßa $2{,}5$:", a: "-2,5", exp: "ƒê·ªïi d·∫•u", hint: "Th√™m d·∫•u -"},
            {q: "S·ªë kh√¥ng √¢m kh√¥ng d∆∞∆°ng:", a: "0", exp: "S·ªë 0", hint: "ƒê·∫∑c bi·ªát"},
            {q: "Vi·∫øt $-0{,}6$ d·∫°ng ph√¢n s·ªë:", a: "-3/5", exp: "$-6/10 = -3/5$", hint: "R√∫t g·ªçn"},
            {q: "Kho·∫£ng c√°ch $-\\frac{1}{2}$ ƒë·∫øn $O$:", a: "0,5", exp: "$|-1/2| = 0{,}5$", hint: "Tr·ªã tuy·ªát ƒë·ªëi"},
            {q: "K√Ω hi·ªáu s·ªë h·ªØu t·ªâ:", a: "Q", exp: "$\\mathbb{Q}$", hint: "Sau P"},
            {q: "S·ªë ƒë·ªëi c·ªßa $-\\frac{3}{4}$:", a: "3/4", exp: "ƒê·ªïi d·∫•u", hint: "B·ªè d·∫•u -"},
            {q: "Vi·∫øt $0{,}25$ d·∫°ng ph√¢n s·ªë t·ªëi gi·∫£n:", a: "1/4", exp: "$25/100 = 1/4$", hint: "R√∫t g·ªçn 25"},
            {q: "$\\frac{-7}{1}$ b·∫±ng s·ªë nguy√™n n√†o:", a: "-7", exp: "Chia cho 1", hint: "B·ªè m·∫´u"},
            {q: "S·ªë √¢m l·ªõn nh·∫•t c√≥ 1 ch·ªØ s·ªë:", a: "-1", exp: "G·∫ßn 0 nh·∫•t", hint: "Xa 0 √≠t nh·∫•t"},
            {q: "T·ªïng c·ªßa $\\frac{1}{2}$ v√† s·ªë ƒë·ªëi c·ªßa n√≥:", a: "0", exp: "Lu√¥n = 0", hint: "ƒê·∫∑c ƒëi·ªÉm s·ªë ƒë·ªëi"},
            {q: "Vi·∫øt $-1{,}5$ d·∫°ng ph√¢n s·ªë:", a: "-3/2", exp: "$-15/10 = -3/2$", hint: "Nh√¢n 10"},
            {q: "$|\\frac{-5}{6}|$ b·∫±ng:", a: "5/6", exp: "B·ªè d·∫•u -", hint: "Tr·ªã tuy·ªát ƒë·ªëi"}
        ];

        let MCQ = [], TF = [], FILL = [];
        let userMcq = Array(15).fill(null);
        let userTf = Array(5).fill(null).map(() => Array(4).fill(null));
        let submitted = false;

        function shuffle(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }

        function generateQuestions() {
            MCQ = [];
            
            // 7 nh·∫≠n bi·∫øt
            const nb = [...QUESTION_BANK.nb];
            shuffle(nb);
            for (let i = 0; i < 7; i++) {
                const q = nb[i % nb.length];
                MCQ.push(q.gen ? {...q.gen(), l: "nb"} : {...q, l: "nb"});
            }
            
            // 5 th√¥ng hi·ªÉu
            const th = [...QUESTION_BANK.th];
            shuffle(th);
            for (let i = 0; i < 5; i++) {
                const q = th[i % th.length];
                MCQ.push(q.gen ? {...q.gen(), l: "th"} : {...q, l: "th"});
            }
            
            // 3 v·∫≠n d·ª•ng
            const vd = [...QUESTION_BANK.vd];
            shuffle(vd);
            for (let i = 0; i < 3; i++) {
                const q = vd[i % vd.length];
                MCQ.push(q.gen ? {...q.gen(), l: "vd"} : {...q, l: "vd"});
            }

            // T/F - Ch·ªçn ng·∫´u nhi√™n 5 c√¢u t·ª´ ng√¢n h√†ng
            const tfPool = [...TF_BANK];
            shuffle(tfPool);
            TF = tfPool.slice(0, 5);

            // FILL - Ch·ªçn ng·∫´u nhi√™n 5 c√¢u t·ª´ ng√¢n h√†ng
            const fillPool = [...FILL_BANK];
            shuffle(fillPool);
            FILL = fillPool.slice(0, 5);
        }

        function init() {
            generateQuestions();
            renderAll();
        }

        function toggleHint(id) {
            const el = document.getElementById(id);
            el.style.display = el.style.display === 'block' ? 'none' : 'block';
        }

        function renderAll() {
            const mcqBox = document.getElementById('mcq-container');
            mcqBox.innerHTML = "";
            
            MCQ.forEach((d, i) => {
                if (!d || !d.q) return;
                
                let badge = '';
                if (d.l === 'nb') badge = '<span class="level-badge level-nhan-biet">NH·∫¨N BI·∫æT</span>';
                else if (d.l === 'th') badge = '<span class="level-badge level-thong-hieu">TH√îNG HI·ªÇU</span>';
                else if (d.l === 'vd') badge = '<span class="level-badge level-van-dung">V·∫¨N D·ª§NG</span>';

                const opts = (d.opts || d.options || []).map((o, j) => 
                    `<div onclick="setMcq(${i},${j})" id="mcq-${i}-${j}" class="mcq-option p-4 bg-white shadow-sm flex items-center mb-2">
                        <span class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 mr-3 font-bold text-xs">${String.fromCharCode(65+j)}</span> ${o}
                    </div>`
                ).join('');
                
                mcqBox.innerHTML += `
                    <div class="p-5 border-b" id="mcq-card-${i}">
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-bold text-blue-600">C√ÇU ${i+1} ${badge}</span>
                            <button onclick="toggleHint('mcq-hint-${i}')" class="hint-btn">üí° G·ª£i √Ω</button>
                        </div>
                        <p class="mb-4 text-slate-700 font-medium">${d.q}</p>
                        <div id="mcq-hint-${i}" class="hint-box">üí° ${d.hint}</div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">${opts}</div>
                        <div id="mcq-fb-${i}" class="feedback-box"></div>
                    </div>
                `;
            });

            const tfBox = document.getElementById('tf-container');
            tfBox.innerHTML = "";
            TF.forEach((d, i) => {
                const rows = d.items.map((it, j) => `
                    <tr class="border-b">
                        <td class="py-4 px-4 text-sm font-medium">
                            ${it.t}
                            <button onclick="toggleHint('tf-hint-${i}-${j}')" class="hint-btn">üí° G·ª£i √Ω</button>
                            <div id="tf-hint-${i}-${j}" class="hint-box">üí° ${it.h}</div>
                            <div id="tf-fb-${i}-${j}" class="feedback-box"></div>
                        </td>
                        <td class="p-2 text-center">
                            <button onclick="setTf(${i},${j},true)" id="tf-btn-${i}-${j}-t" class="check-btn w-10 h-10 rounded-xl">ƒê</button>
                        </td>
                        <td class="p-2 text-center">
                            <button onclick="setTf(${i},${j},false)" id="tf-btn-${i}-${j}-s" class="check-btn w-10 h-10 rounded-xl">S</button>
                        </td>
                    </tr>
                `).join('');
                
                tfBox.innerHTML += `
                    <div class="bg-slate-50 rounded-2xl border overflow-hidden">
                        <div class="bg-white p-4 font-bold text-blue-800 border-b">${d.q}</div>
                        <table class="w-full"><tbody>${rows}</tbody></table>
                    </div>
                `;
            });

            const fillBox = document.getElementById('fill-container');
            fillBox.innerHTML = "";
            FILL.forEach((d, i) => {
                fillBox.innerHTML += `
                    <div class="bg-slate-50 p-5 rounded-2xl border space-y-2">
                        <div class="flex items-start justify-between">
                            <span><strong>C√¢u ${i+1}.</strong> ${d.q}</span>
                            <button onclick="toggleHint('fill-hint-${i}')" class="hint-btn">üí° G·ª£i √Ω</button>
                        </div>
                        <div id="fill-hint-${i}" class="hint-box">üí° ${d.hint}</div>
                        <div class="flex items-center gap-4 mt-2">
                            <input type="text" id="fill-${i}" class="fill-input">
                        </div>
                        <div id="fill-fb-${i}" class="feedback-box"></div>
                    </div>
                `;
            });
            
            if (window.MathJax) MathJax.typeset();
        }

        function setMcq(q, o) {
            if (submitted) return;
            userMcq[q] = o;
            document.getElementById(`mcq-card-${q}`).querySelectorAll('.mcq-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById(`mcq-${q}-${o}`).classList.add('selected');
        }

        function setTf(q, i, v) {
            if (submitted) return;
            userTf[q][i] = v;
            document.getElementById(`tf-btn-${q}-${i}-t`).classList.remove('selected-true');
            document.getElementById(`tf-btn-${q}-${i}-s`).classList.remove('selected-false');
            if (v) document.getElementById(`tf-btn-${q}-${i}-t`).classList.add('selected-true');
            else document.getElementById(`tf-btn-${q}-${i}-s`).classList.add('selected-false');
        }

        function celebrate(score) {
            const pct = (score / 10) * 100;
            if (pct >= 90) {
                const end = Date.now() + 3000;
                const interval = setInterval(() => {
                    if (Date.now() > end) { clearInterval(interval); return; }
                    confetti({ particleCount: 100, spread: 160, origin: { y: 0.6 } });
                }, 250);
            } else if (pct >= 70) {
                confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
                setTimeout(() => confetti({ particleCount: 100, spread: 80, origin: { y: 0.6 } }), 500);
            } else if (pct >= 50) {
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            } else {
                confetti({ particleCount: 50, spread: 50, origin: { y: 0.6 } });
            }
        }

        function checkResults() {
            submitted = true;
            let correct = 0;
            let total = MCQ.length + TF.length * 4 + FILL.length;

            MCQ.forEach((d, i) => {
                const fb = document.getElementById(`mcq-fb-${i}`);
                const opts = document.getElementById(`mcq-card-${i}`).querySelectorAll('.mcq-option');
                const correctIdx = d.ans !== undefined ? d.ans : d.correct;
                opts[correctIdx].classList.add('correct');
                
                if (userMcq[i] === correctIdx) {
                    correct++;
                    fb.innerHTML = "‚úîÔ∏è <strong>ƒê√∫ng!</strong> " + d.exp;
                    fb.className = "feedback-box block text-green-700 bg-green-50 border-green-300";
                    fb.style.display = 'block';
                } else {
                    if (userMcq[i] !== null) opts[userMcq[i]].classList.add('wrong');
                    fb.innerHTML = "‚ùå <strong>Sai!</strong> " + d.exp;
                    fb.className = "feedback-box block text-red-700 bg-red-50 border-red-300";
                    fb.style.display = 'block';
                }
            });

            TF.forEach((d, i) => {
                d.items.forEach((it, j) => {
                    const fb = document.getElementById(`tf-fb-${i}-${j}`);
                    if (userTf[i][j] === it.a) {
                        correct++;
                        fb.innerHTML = "‚úîÔ∏è " + it.exp;
                        fb.className = "feedback-box block text-green-700 bg-green-50 border-green-300";
                    } else {
                        fb.innerHTML = "‚ùå " + it.exp;
                        fb.className = "feedback-box block text-red-700 bg-red-50 border-red-300";
                    }
                    fb.style.display = 'block';
                    if (it.a) document.getElementById(`tf-btn-${i}-${j}-t`).classList.add('correct-highlight');
                    else document.getElementById(`tf-btn-${i}-${j}-s`).classList.add('correct-highlight');
                });
            });

            FILL.forEach((d, i) => {
                const input = document.getElementById(`fill-${i}`);
                const fb = document.getElementById(`fill-fb-${i}`);
                const user = input.value.trim().toLowerCase().replace(/\s+/g, '');
                const ans = d.a.toLowerCase().replace(/\s+/g, '');
                
                if (user === ans) {
                    correct++;
                    input.classList.add('fill-correct');
                    fb.innerHTML = "‚úîÔ∏è " + d.exp;
                    fb.className = "feedback-box block text-green-700 bg-green-50 border-green-300";
                } else {
                    input.classList.add('fill-wrong');
                    fb.innerHTML = "‚ùå ƒê√°p √°n: <strong>" + d.a + "</strong>. " + d.exp;
                    fb.className = "feedback-box block text-red-700 bg-red-50 border-red-300";
                }
                fb.style.display = 'block';
            });

            const score = (correct / total) * 10;
            const pct = (correct / total) * 100;
            
            document.getElementById('submit-btn').classList.add('hidden');
            document.getElementById('result-board').classList.remove('hidden');
            
            const scoreText = document.getElementById('score-text');
            scoreText.innerHTML = `
                <div class="text-center">
                    <div class="text-5xl font-black mb-2">${score.toFixed(1)}/10</div>
                    <div class="text-lg">ƒê√∫ng ${correct}/${total} c√¢u (${pct.toFixed(0)}%)</div>
                </div>
            `;
            
            if (pct >= 90) {
                scoreText.classList.add('score-excellent');
                document.getElementById('score-message').innerHTML = 'üéâ <span class="text-green-600">XU·∫§T S·∫ÆC!</span>';
            } else if (pct >= 70) {
                scoreText.classList.add('score-good');
                document.getElementById('score-message').innerHTML = 'üëè <span class="text-blue-600">KH√Å T·ªêT!</span>';
            } else if (pct >= 50) {
                scoreText.classList.add('score-average');
                document.getElementById('score-message').innerHTML = 'üí™ <span class="text-orange-600">TRUNG B√åNH</span>';
            } else {
                scoreText.classList.add('score-low');
                document.getElementById('score-message').innerHTML = 'üìö <span class="text-red-600">C·∫¶N C·ªê G·∫ÆNG</span>';
            }
            
            celebrate(score);
            showOptions();
            
            if (window.MathJax) MathJax.typeset();
            document.getElementById('result-board').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function showOptions() {
            const old = document.getElementById('post-options');
            if (old) old.remove();

            const container = document.getElementById('result-board');
            const div = document.createElement('div');
            div.id = 'post-options';
            div.className = 'mt-8 p-6 bg-white rounded-2xl shadow-xl border-2 border-blue-400 animate-bounce-in';
            
            div.innerHTML = `
                <h3 class="text-xl font-bold text-blue-800 mb-4 text-center">üåü Ti·∫øp t·ª•c?</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="regenerate('retry')" class="p-4 bg-gray-100 hover:bg-gray-200 rounded-xl transition-all border-b-4 border-gray-300 active:border-b-0 font-bold text-gray-700">
                        üîÑ L√†m l·∫°i
                    </button>
                    <button onclick="regenerate('equivalent')" class="p-4 bg-blue-100 hover:bg-blue-200 rounded-xl transition-all border-b-4 border-blue-300 active:border-b-0 font-bold text-blue-700">
                        üìö ƒê·ªÅ m·ªõi t∆∞∆°ng ƒë∆∞∆°ng
                    </button>
                    <button onclick="regenerate('harder')" class="p-4 bg-orange-100 hover:bg-orange-200 rounded-xl transition-all border-b-4 border-orange-300 active:border-b-0 font-bold text-orange-700">
                        üöÄ ƒê·ªÅ n√¢ng cao
                    </button>
                </div>
            `;
            container.appendChild(div);
        }

        async function regenerate(mode) {
            document.getElementById('loading-overlay').style.display = 'flex';
            await new Promise(r => setTimeout(r, 800));
            
            if (mode === 'retry') {
                submitted = false;
                userMcq = Array(15).fill(null);
                userTf = Array(5).fill(null).map(() => Array(4).fill(null));
                const opts = document.getElementById('post-options');
                if (opts) opts.remove();
                document.getElementById('submit-btn').classList.remove('hidden');
                document.getElementById('result-board').classList.add('hidden');
                renderAll();
            } else {
                generateQuestions();
                submitted = false;
                userMcq = Array(15).fill(null);
                userTf = Array(5).fill(null).map(() => Array(4).fill(null));
                const opts = document.getElementById('post-options');
                if (opts) opts.remove();
                document.getElementById('result-board').classList.add('hidden');
                document.getElementById('submit-btn').classList.remove('hidden');
                renderAll();
            }
            
            document.getElementById('loading-overlay').style.display = 'none';
            document.getElementById('capture-mcq').scrollIntoView({ behavior: 'smooth' });
        }

        function unlockGift() {
            if (document.getElementById('warmup-input').value.trim() === "0") {
                document.getElementById('warmup-task').classList.add('hidden');
                document.getElementById('gift-section').classList.remove('hidden');
                confetti({ particleCount: 50 });
            } else {
                alert("‚ùå Sai r·ªìi! G·ª£i √Ω: Kh√¥ng d∆∞∆°ng kh√¥ng √¢m...");
            }
        }

        function openGift() {
            document.getElementById('gift-section').classList.add('hidden');
            document.getElementById('reward-content').classList.remove('hidden');
            confetti({ particleCount: 100 });
        }

        // H√ÄM T·∫¢I PDF KI·∫æN TH·ª®C
        async function downloadKnowledgePDF() {
            const element = document.getElementById('capture-knowledge');
            const opt = {
                margin: 15,
                filename: 'Kien-thuc-Tap-hop-so-huu-ti.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            try {
                await html2pdf().set(opt).from(element).save();
            } catch (error) {
                alert('ƒê√£ x·∫£y ra l·ªói khi t·∫£i PDF. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }

        // H√ÄM T·∫¢I PDF ƒê·ªÄ B√ÄI
        async function downloadExamPDF() {
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.style.display = 'flex';
            loadingOverlay.querySelector('p').textContent = 'ƒêang t·∫°o PDF...';
            
            // T·∫°o container t·∫°m ƒë·ªÉ ch·ª©a ƒë·ªÅ b√†i
            const tempContainer = document.createElement('div');
            tempContainer.style.fontFamily = 'Arial, sans-serif';
            tempContainer.style.padding = '20px';
            
            // Ti√™u ƒë·ªÅ
            tempContainer.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h1 style="color: #2563eb; font-size: 24px; font-weight: bold;">B√ÄI 1: T·∫¨P H·ª¢P S·ªê H·ªÆU T·ªà</h1>
                    <p style="color: #64748b; font-size: 14px;">K·∫øt n·ªëi tri th·ª©c - To√°n 7</p>
                </div>
            `;
            
            // PH·∫¶N TR·∫ÆC NGHI·ªÜM
            let mcqHTML = '<div style="margin-bottom: 30px;"><h2 style="color: #1e40af; font-size: 18px; margin-bottom: 15px;">PH·∫¶N 1: TR·∫ÆC NGHI·ªÜM (15 c√¢u)</h2>';
            MCQ.forEach((q, i) => {
                mcqHTML += `<div style="margin-bottom: 15px; page-break-inside: avoid;">
                    <p style="font-weight: bold;">C√¢u ${i + 1}: ${q.q.replace(/\$/g, '')}</p>`;
                (q.opts || q.options || []).forEach((opt, j) => {
                    mcqHTML += `<p style="margin-left: 20px;">${String.fromCharCode(65 + j)}. ${opt.replace(/\$/g, '')}</p>`;
                });
                mcqHTML += '</div>';
            });
            mcqHTML += '</div>';
            
            // PH·∫¶N ƒê√öNG/SAI
            let tfHTML = '<div style="margin-bottom: 30px;"><h2 style="color: #1e40af; font-size: 18px; margin-bottom: 15px;">PH·∫¶N 2: ƒê√öNG/SAI (5 c√¢u)</h2>';
            TF.forEach((q, i) => {
                tfHTML += `<div style="margin-bottom: 20px; page-break-inside: avoid;">
                    <p style="font-weight: bold;">${q.q}</p>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                        <thead>
                            <tr style="background-color: #f1f5f9;">
                                <th style="border: 1px solid #cbd5e1; padding: 8px; text-align: left; width: 70%;">N·ªôi dung</th>
                                <th style="border: 1px solid #cbd5e1; padding: 8px; text-align: center;">ƒê√∫ng</th>
                                <th style="border: 1px solid #cbd5e1; padding: 8px; text-align: center;">Sai</th>
                            </tr>
                        </thead>
                        <tbody>`;
                q.items.forEach(item => {
                    tfHTML += `<tr>
                        <td style="border: 1px solid #cbd5e1; padding: 8px;">${item.t.replace(/\$/g, '')}</td>
                        <td style="border: 1px solid #cbd5e1; padding: 8px; text-align: center;">‚òê</td>
                        <td style="border: 1px solid #cbd5e1; padding: 8px; text-align: center;">‚òê</td>
                    </tr>`;
                });
                tfHTML += '</tbody></table></div>';
            });
            tfHTML += '</div>';
            
            // PH·∫¶N ƒêI·ªÄN ƒê√ÅP √ÅN
            let fillHTML = '<div style="margin-bottom: 30px;"><h2 style="color: #1e40af; font-size: 18px; margin-bottom: 15px;">PH·∫¶N 3: ƒêI·ªÄN ƒê√ÅP √ÅN (5 c√¢u)</h2>';
            FILL.forEach((q, i) => {
                fillHTML += `<div style="margin-bottom: 15px; page-break-inside: avoid;">
                    <p><strong>C√¢u ${i + 1}.</strong> ${q.q.replace(/\$/g, '')}</p>
                    <p style="margin-left: 20px; margin-top: 5px;">ƒê√°p √°n: _____________________</p>
                </div>`;
            });
            fillHTML += '</div>';
            
            tempContainer.innerHTML += mcqHTML + tfHTML + fillHTML;
            
            const opt = {
                margin: 15,
                filename: 'De-bai-Tap-hop-so-huu-ti.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            try {
                await html2pdf().set(opt).from(tempContainer).save();
                loadingOverlay.style.display = 'none';
            } catch (error) {
                loadingOverlay.style.display = 'none';
                alert('ƒê√£ x·∫£y ra l·ªói khi t·∫£i PDF. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }

        window.onload = init;
    </script>
</body>
</html>